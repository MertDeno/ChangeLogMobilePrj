{"version":3,"file":"Device.js","sources":["../src/Device/EventProvider.ts","../src/Device/Media.ts","../src/Device/index.ts"],"sourcesContent":["import EventProviderWC from '@ui5/webcomponents-base/dist/EventProvider.js';\n\nexport const EventProvider = new EventProviderWC();\n","import { EventProvider } from './EventProvider';\n\ninterface Query {\n  media?: MediaQueryList;\n  query: string;\n  from: number;\n  to: number;\n}\n\ninterface RangeInfo {\n  from: number;\n  to?: number;\n  name: 'Phone' | 'Tablet' | 'Desktop' | 'LargeDesktop';\n  unit: string;\n}\n\ninterface RangeSet {\n  points: number[];\n  unit: string;\n  name: string;\n  names: RangeInfo['name'][];\n\n  queries?: Query[];\n  timer?: number;\n  currentquery?: Query;\n  listener?: () => void;\n}\n\n// private helpers\nlet activeRangeSet: RangeSet;\n\nconst matchLegacyBySize = (from, to, unit, width) => {\n  const a = from < 0 || from <= width;\n  const b = to < 0 || width <= to;\n  return a && b;\n};\n\nconst getQuery = (from: number, to: number, unit = 'px') => {\n  let q = 'all';\n  if (from > 0) {\n    q = `${q} and (min-width:${from}${unit})`;\n  }\n  if (to > 0) {\n    q = `${q} and (max-width:${to}${unit})`;\n  }\n  return q;\n};\n\nconst getRangeInfo = (iRangeIdx: number): RangeInfo => {\n  const q = activeRangeSet.queries[iRangeIdx];\n  const info: RangeInfo = { from: q.from, unit: activeRangeSet.unit, name: activeRangeSet.names[iRangeIdx] };\n  if (q.to >= 0) {\n    info.to = q.to;\n  }\n  return info;\n};\n\nconst matches = (from: number, to: number, unit: string) => {\n  const q = getQuery(from, to, unit);\n  const mm = window.matchMedia(q); // FF returns null when running within an iframe with display:none\n  return mm && mm.matches;\n};\n\nconst checkQueries = (infoOnly, matcher = matches): RangeInfo => {\n  const aQueries = activeRangeSet.queries;\n  let info = null;\n  for (let i = 0, len = aQueries.length; i < len; i++) {\n    const q = aQueries[i];\n    if ((q !== activeRangeSet.currentquery || infoOnly) && matcher(q.from, q.to, activeRangeSet.unit)) {\n      if (!infoOnly) {\n        activeRangeSet.currentquery = q;\n      }\n      info = getRangeInfo(i);\n    }\n  }\n\n  return info;\n};\n\nconst handleChange = (): void => {\n  if (activeRangeSet.timer) {\n    clearTimeout(activeRangeSet.timer);\n    activeRangeSet.timer = null;\n  }\n\n  activeRangeSet.timer = window.setTimeout(() => {\n    const mParams = checkQueries(false);\n    if (mParams) {\n      EventProvider.fireEvent(`media`, mParams);\n    }\n  }, 0);\n};\n\nconst DEFAULT_RANGE_SET = 'StdExt';\n\nconst initRangeSet = (): void => {\n  if (activeRangeSet) {\n    return;\n  }\n\n  const oConfig: RangeSet = {\n    points: [600, 1024, 1440],\n    unit: 'px',\n    name: DEFAULT_RANGE_SET,\n    names: ['Phone', 'Tablet', 'Desktop', 'LargeDesktop']\n  };\n\n  oConfig.queries = [];\n  oConfig.timer = null;\n  oConfig.currentquery = null;\n  oConfig.listener = () => handleChange();\n\n  const rangeBorders = oConfig.points;\n  for (let i = 0, len = rangeBorders.length; i <= len; i++) {\n    const from = i === 0 ? 0 : rangeBorders[i - 1];\n    const to = i === rangeBorders.length ? -1 : rangeBorders[i] - 1;\n    const query = getQuery(from, to, oConfig.unit);\n    const media = window.matchMedia(query);\n    media.addEventListener('change', oConfig.listener);\n    oConfig.queries.push({\n      query,\n      from,\n      to,\n      media\n    });\n  }\n\n  activeRangeSet = oConfig;\n\n  oConfig.listener();\n};\n\n// public API\n\nexport const getCurrentRange = (width?: number): RangeInfo => {\n  if (!activeRangeSet) {\n    initRangeSet();\n  }\n\n  return checkQueries(true, isNaN(width) ? undefined : (from, to, unit) => matchLegacyBySize(from, to, unit, width));\n};\n\nexport const attachMediaHandler = (func: (rangeInfo: RangeInfo) => void): void => {\n  if (!activeRangeSet) {\n    initRangeSet();\n  }\n  EventProvider.attachEvent(`media`, func);\n};\n\nexport const detachMediaHandler = (func: (rangeInfo: RangeInfo) => void): void => {\n  EventProvider.detachEvent(`media`, func);\n};\n","import '@ui5/webcomponents-react-base/types/UI5Device.d.ts';\nimport { supportsTouch } from '@ui5/webcomponents-base/dist/Device.js';\nimport { EventProvider } from './EventProvider';\n\nconst getActualWindowSize = (): [width: number, height: number] => {\n  return [window.innerWidth, window.innerHeight];\n};\n\nlet iResizeTimeout;\nlet bOrientationChange = false;\nlet bResize = false;\nlet iOrientationTimeout;\nlet iClearFlagTimeout;\nlet [iWindowWidthOld, iWindowHeightOld] = getActualWindowSize();\nlet bKeyboardOpen = false;\nlet iLastResizeTime;\nconst rInputTagRegex = /INPUT|TEXTAREA|SELECT/;\n\ninterface IOrientation {\n  landscape: boolean;\n  portrait: boolean;\n}\n\ninterface IWindowSize {\n  height: number;\n  width: number;\n}\n\nconst internalWindowSize: IWindowSize = {\n  height: 0,\n  width: 0\n};\n\nconst internalOrientation: IOrientation = {\n  landscape: false,\n  portrait: false\n};\n\n// PRIVATE API\n\nconst isLandscape = () => {\n  return !!window.matchMedia('(orientation: landscape)').matches;\n};\n\nconst setResizeInfo = () => {\n  internalWindowSize.width = getActualWindowSize()[0];\n  internalWindowSize.height = getActualWindowSize()[1];\n};\n\nconst setOrientationInfo = () => {\n  internalOrientation.landscape = isLandscape();\n  internalOrientation.portrait = !internalOrientation.landscape;\n};\n\nconst clearFlags = () => {\n  bOrientationChange = false;\n  bResize = false;\n  iClearFlagTimeout = null;\n};\n\nlet eventListenersInitialized = false;\nconst initEventListeners = () => {\n  // Add handler for orientationchange and resize after initialization of Device API\n  if (supportsTouch()) {\n    // logic for mobile devices which support orientationchange (like ios, android)\n    window.addEventListener('resize', handleMobileOrientationResizeChange, false);\n    window.addEventListener('orientationchange', handleMobileOrientationResizeChange, false);\n  } else {\n    // desktop browsers and windows phone/tablet which not support orientationchange\n    window.addEventListener('resize', handleResizeEvent, false);\n  }\n  setResizeInfo();\n  setOrientationInfo();\n  eventListenersInitialized = true;\n};\n\n// orientation change\nconst handleOrientationChange = () => {\n  setOrientationInfo();\n  EventProvider.fireEvent('orientation', {\n    landscape: internalOrientation.landscape,\n    portrait: internalOrientation.portrait\n  });\n};\n\nconst handleMobileTimeout = () => {\n  // with ios split view, the browser fires only resize event and no orientationchange\n  // when changing the size of a split view\n  // therefore the following if needs to be adapted with additional check of iPad with version greater or equal 9\n  // (splitview was introduced with iOS 9)\n  if (bResize && bOrientationChange) {\n    handleOrientationChange();\n    handleResizeChange();\n    bOrientationChange = false;\n    bResize = false;\n    if (iClearFlagTimeout) {\n      window.clearTimeout(iClearFlagTimeout);\n      iClearFlagTimeout = null;\n    }\n  }\n  iOrientationTimeout = null;\n};\n\nconst handleMobileOrientationResizeChange = (evt) => {\n  if (evt.type === 'resize') {\n    if (rInputTagRegex.test(document.activeElement.tagName) && !bOrientationChange) {\n      return;\n    }\n\n    const [iWindowWidthNew, iWindowHeightNew] = getActualWindowSize();\n    const iTime = new Date().getTime();\n    // skip multiple resize events by only one orientationchange\n    if (iWindowHeightNew === iWindowHeightOld && iWindowWidthNew === iWindowWidthOld) {\n      return;\n    }\n    bResize = true;\n    // on mobile devices opening the keyboard on some devices leads to a resize event\n    // in this case only the height changes, not the width\n    if (iWindowHeightOld !== iWindowHeightNew && iWindowWidthOld === iWindowWidthNew) {\n      // Asus Transformer tablet fires two resize events when orientation changes while keyboard is open.\n      // Between these two events, only the height changes. The check of if keyboard is open has to be skipped because\n      // it may be judged as keyboard closed but the keyboard is still\n      // open which will affect the orientation detection\n      if (!iLastResizeTime || iTime - iLastResizeTime > 300) {\n        bKeyboardOpen = iWindowHeightNew < iWindowHeightOld;\n      }\n      handleResizeChange();\n    } else {\n      iWindowWidthOld = iWindowWidthNew;\n    }\n    iLastResizeTime = iTime;\n    iWindowHeightOld = iWindowHeightNew;\n\n    if (iClearFlagTimeout) {\n      window.clearTimeout(iClearFlagTimeout);\n      iClearFlagTimeout = null;\n    }\n    // Some Android build-in browser fires a resize event after the viewport is applied.\n    // This resize event has to be dismissed otherwise when the next orientationchange event happens,\n    // a UI5 resize event will be fired with the wrong window size.\n    iClearFlagTimeout = window.setTimeout(clearFlags, 1200);\n  } else if (evt.type === 'orientationchange') {\n    bOrientationChange = true;\n  }\n\n  if (iOrientationTimeout) {\n    clearTimeout(iOrientationTimeout);\n    iOrientationTimeout = null;\n  }\n  iOrientationTimeout = window.setTimeout(handleMobileTimeout, 50);\n};\n\n// RESIZE ONLY WITHOUT ORIENTATION CHANGE\nconst handleResizeChange = () => {\n  setResizeInfo();\n  EventProvider.fireEvent('resize', {\n    height: internalWindowSize.height,\n    width: internalWindowSize.width\n  });\n};\n\nconst handleResizeTimeout = () => {\n  handleResizeChange();\n  iResizeTimeout = null;\n};\n\nconst handleResizeEvent = () => {\n  const wasL = internalOrientation.landscape;\n  const isL = isLandscape();\n  if (wasL !== isL) {\n    handleOrientationChange();\n  }\n  // throttle resize events because most browsers throw one or more resize events per pixel\n  // for every resize event inside the period from 150ms (starting from the first resize event),\n  // we only fire one resize event after this period\n  if (!iResizeTimeout) {\n    iResizeTimeout = window.setTimeout(handleResizeTimeout, 150);\n  }\n};\n\n// re-export everything from the web components device\nexport { isIE, isSafari, isDesktop, isTablet, isPhone, supportsTouch } from '@ui5/webcomponents-base/dist/Device.js';\n// export all media methods\nexport { attachMediaHandler, detachMediaHandler, getCurrentRange } from './Media';\n\n// resize events\nexport const attachResizeHandler = (fnFunction: (windowSize: IWindowSize) => void): void => {\n  if (!eventListenersInitialized) {\n    initEventListeners();\n  }\n  EventProvider.attachEvent('resize', fnFunction);\n};\n\nexport const detachResizeHandler = (fnFunction: (windowSize: IWindowSize) => void) => {\n  EventProvider.detachEvent('resize', fnFunction);\n};\n\n// orientation change events\nexport const getOrientation = (): IOrientation => {\n  return internalOrientation;\n};\n\nexport const attachOrientationChangeHandler = (fnFunction: (orientation: IOrientation) => void): void => {\n  if (!eventListenersInitialized) {\n    initEventListeners();\n  }\n  EventProvider.attachEvent('orientation', fnFunction);\n};\n\nexport const detachOrientationChangeHandler = (fnFunction: (orientation: IOrientation) => void) => {\n  EventProvider.detachEvent('orientation', fnFunction);\n};\n"],"names":["EventProvider","EventProviderWC","activeRangeSet","matchLegacyBySize","from","to","unit","width","a","b","getQuery","q","getRangeInfo","iRangeIdx","queries","info","name","names","matches","mm","window","matchMedia","checkQueries","infoOnly","matcher","aQueries","i","len","length","currentquery","handleChange","timer","clearTimeout","setTimeout","mParams","fireEvent","DEFAULT_RANGE_SET","initRangeSet","oConfig","points","listener","rangeBorders","query","media","addEventListener","push","getCurrentRange","isNaN","undefined","attachMediaHandler","func","attachEvent","detachMediaHandler","detachEvent","getActualWindowSize","innerWidth","innerHeight","iResizeTimeout","bOrientationChange","bResize","iOrientationTimeout","iClearFlagTimeout","iWindowWidthOld","iWindowHeightOld","rInputTagRegex","internalWindowSize","height","internalOrientation","landscape","portrait","isLandscape","setResizeInfo","setOrientationInfo","clearFlags","eventListenersInitialized","initEventListeners","supportsTouch","handleMobileOrientationResizeChange","handleResizeEvent","handleOrientationChange","handleMobileTimeout","handleResizeChange","evt","type","test","document","activeElement","tagName","iWindowWidthNew","iWindowHeightNew","Date","getTime","handleResizeTimeout","wasL","isL","attachResizeHandler","fnFunction","detachResizeHandler","getOrientation","attachOrientationChangeHandler","detachOrientationChangeHandler"],"mappings":";;;;;AAEO,IAAMA,aAAa,GAAG,IAAIC,eAAJ,EAAtB;;AC0BP;AACA,IAAIC,cAAJ;;AAEA,IAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,IAAD,EAAOC,EAAP,EAAWC,IAAX,EAAiBC,KAAjB,EAA2B;AACnD,MAAMC,CAAC,GAAGJ,IAAI,GAAG,CAAP,IAAYA,IAAI,IAAIG,KAA9B;AACA,MAAME,CAAC,GAAGJ,EAAE,GAAG,CAAL,IAAUE,KAAK,IAAIF,EAA7B;AACA,SAAOG,CAAC,IAAIC,CAAZ;AACD,CAJD;;AAMA,IAAMC,QAAQ,GAAG,SAAXA,QAAW,CAACN,IAAD,EAAeC,EAAf,EAA2C;AAAA,MAAhBC,IAAgB,uEAAT,IAAS;AAC1D,MAAIK,CAAC,GAAG,KAAR;;AACA,MAAIP,IAAI,GAAG,CAAX,EAAc;AACZO,IAAAA,CAAC,aAAMA,CAAN,6BAA0BP,IAA1B,SAAiCE,IAAjC,MAAD;AACD;;AACD,MAAID,EAAE,GAAG,CAAT,EAAY;AACVM,IAAAA,CAAC,aAAMA,CAAN,6BAA0BN,EAA1B,SAA+BC,IAA/B,MAAD;AACD;;AACD,SAAOK,CAAP;AACD,CATD;;AAWA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,SAAD,EAAkC;AACrD,MAAMF,CAAC,GAAGT,cAAc,CAACY,OAAf,CAAuBD,SAAvB,CAAV;AACA,MAAME,IAAe,GAAG;AAAEX,IAAAA,IAAI,EAAEO,CAAC,CAACP,IAAV;AAAgBE,IAAAA,IAAI,EAAEJ,cAAc,CAACI,IAArC;AAA2CU,IAAAA,IAAI,EAAEd,cAAc,CAACe,KAAf,CAAqBJ,SAArB;AAAjD,GAAxB;;AACA,MAAIF,CAAC,CAACN,EAAF,IAAQ,CAAZ,EAAe;AACbU,IAAAA,IAAI,CAACV,EAAL,GAAUM,CAAC,CAACN,EAAZ;AACD;;AACD,SAAOU,IAAP;AACD,CAPD;;AASA,IAAMG,OAAO,GAAG,SAAVA,OAAU,CAACd,IAAD,EAAeC,EAAf,EAA2BC,IAA3B,EAA4C;AAC1D,MAAMK,CAAC,GAAGD,QAAQ,CAACN,IAAD,EAAOC,EAAP,EAAWC,IAAX,CAAlB;AACA,MAAMa,EAAE,GAAGC,MAAM,CAACC,UAAP,CAAkBV,CAAlB,CAAX,CAF0D;;AAG1D,SAAOQ,EAAE,IAAIA,EAAE,CAACD,OAAhB;AACD,CAJD;;AAMA,IAAMI,YAAY,GAAG,SAAfA,YAAe,CAACC,QAAD,EAA4C;AAAA,MAAjCC,OAAiC,uEAAvBN,OAAuB;AAC/D,MAAMO,QAAQ,GAAGvB,cAAc,CAACY,OAAhC;AACA,MAAIC,IAAI,GAAG,IAAX;;AACA,OAAK,IAAIW,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGF,QAAQ,CAACG,MAA/B,EAAuCF,CAAC,GAAGC,GAA3C,EAAgDD,CAAC,EAAjD,EAAqD;AACnD,QAAMf,CAAC,GAAGc,QAAQ,CAACC,CAAD,CAAlB;;AACA,QAAI,CAACf,CAAC,KAAKT,cAAc,CAAC2B,YAArB,IAAqCN,QAAtC,KAAmDC,OAAO,CAACb,CAAC,CAACP,IAAH,EAASO,CAAC,CAACN,EAAX,EAAeH,cAAc,CAACI,IAA9B,CAA9D,EAAmG;AACjG,UAAI,CAACiB,QAAL,EAAe;AACbrB,QAAAA,cAAc,CAAC2B,YAAf,GAA8BlB,CAA9B;AACD;;AACDI,MAAAA,IAAI,GAAGH,YAAY,CAACc,CAAD,CAAnB;AACD;AACF;;AAED,SAAOX,IAAP;AACD,CAdD;;AAgBA,IAAMe,YAAY,GAAG,SAAfA,YAAe,GAAY;AAC/B,MAAI5B,cAAc,CAAC6B,KAAnB,EAA0B;AACxBC,IAAAA,YAAY,CAAC9B,cAAc,CAAC6B,KAAhB,CAAZ;AACA7B,IAAAA,cAAc,CAAC6B,KAAf,GAAuB,IAAvB;AACD;;AAED7B,EAAAA,cAAc,CAAC6B,KAAf,GAAuBX,MAAM,CAACa,UAAP,CAAkB,YAAM;AAC7C,QAAMC,OAAO,GAAGZ,YAAY,CAAC,KAAD,CAA5B;;AACA,QAAIY,OAAJ,EAAa;AACXlC,MAAAA,aAAa,CAACmC,SAAd,UAAiCD,OAAjC;AACD;AACF,GALsB,EAKpB,CALoB,CAAvB;AAMD,CAZD;;AAcA,IAAME,iBAAiB,GAAG,QAA1B;;AAEA,IAAMC,YAAY,GAAG,SAAfA,YAAe,GAAY;AAC/B,MAAInC,cAAJ,EAAoB;AAClB;AACD;;AAED,MAAMoC,OAAiB,GAAG;AACxBC,IAAAA,MAAM,EAAE,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,CADgB;AAExBjC,IAAAA,IAAI,EAAE,IAFkB;AAGxBU,IAAAA,IAAI,EAAEoB,iBAHkB;AAIxBnB,IAAAA,KAAK,EAAE,CAAC,OAAD,EAAU,QAAV,EAAoB,SAApB,EAA+B,cAA/B;AAJiB,GAA1B;AAOAqB,EAAAA,OAAO,CAACxB,OAAR,GAAkB,EAAlB;AACAwB,EAAAA,OAAO,CAACP,KAAR,GAAgB,IAAhB;AACAO,EAAAA,OAAO,CAACT,YAAR,GAAuB,IAAvB;;AACAS,EAAAA,OAAO,CAACE,QAAR,GAAmB;AAAA,WAAMV,YAAY,EAAlB;AAAA,GAAnB;;AAEA,MAAMW,YAAY,GAAGH,OAAO,CAACC,MAA7B;;AACA,OAAK,IAAIb,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGc,YAAY,CAACb,MAAnC,EAA2CF,CAAC,IAAIC,GAAhD,EAAqDD,CAAC,EAAtD,EAA0D;AACxD,QAAMtB,IAAI,GAAGsB,CAAC,KAAK,CAAN,GAAU,CAAV,GAAce,YAAY,CAACf,CAAC,GAAG,CAAL,CAAvC;AACA,QAAMrB,EAAE,GAAGqB,CAAC,KAAKe,YAAY,CAACb,MAAnB,GAA4B,CAAC,CAA7B,GAAiCa,YAAY,CAACf,CAAD,CAAZ,GAAkB,CAA9D;AACA,QAAMgB,KAAK,GAAGhC,QAAQ,CAACN,IAAD,EAAOC,EAAP,EAAWiC,OAAO,CAAChC,IAAnB,CAAtB;AACA,QAAMqC,KAAK,GAAGvB,MAAM,CAACC,UAAP,CAAkBqB,KAAlB,CAAd;AACAC,IAAAA,KAAK,CAACC,gBAAN,CAAuB,QAAvB,EAAiCN,OAAO,CAACE,QAAzC;AACAF,IAAAA,OAAO,CAACxB,OAAR,CAAgB+B,IAAhB,CAAqB;AACnBH,MAAAA,KAAK,EAALA,KADmB;AAEnBtC,MAAAA,IAAI,EAAJA,IAFmB;AAGnBC,MAAAA,EAAE,EAAFA,EAHmB;AAInBsC,MAAAA,KAAK,EAALA;AAJmB,KAArB;AAMD;;AAEDzC,EAAAA,cAAc,GAAGoC,OAAjB;AAEAA,EAAAA,OAAO,CAACE,QAAR;AACD,CAnCD;;;IAuCaM,eAAe,GAAG,SAAlBA,eAAkB,CAACvC,KAAD,EAA+B;AAC5D,MAAI,CAACL,cAAL,EAAqB;AACnBmC,IAAAA,YAAY;AACb;;AAED,SAAOf,YAAY,CAAC,IAAD,EAAOyB,KAAK,CAACxC,KAAD,CAAL,GAAeyC,SAAf,GAA2B,UAAC5C,IAAD,EAAOC,EAAP,EAAWC,IAAX;AAAA,WAAoBH,iBAAiB,CAACC,IAAD,EAAOC,EAAP,EAAWC,IAAX,EAAiBC,KAAjB,CAArC;AAAA,GAAlC,CAAnB;AACD;IAEY0C,kBAAkB,GAAG,SAArBA,kBAAqB,CAACC,IAAD,EAAgD;AAChF,MAAI,CAAChD,cAAL,EAAqB;AACnBmC,IAAAA,YAAY;AACb;;AACDrC,EAAAA,aAAa,CAACmD,WAAd,UAAmCD,IAAnC;AACD;IAEYE,kBAAkB,GAAG,SAArBA,kBAAqB,CAACF,IAAD,EAAgD;AAChFlD,EAAAA,aAAa,CAACqD,WAAd,UAAmCH,IAAnC;AACD;;ACnJD,IAAMI,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAuC;AACjE,SAAO,CAAClC,MAAM,CAACmC,UAAR,EAAoBnC,MAAM,CAACoC,WAA3B,CAAP;AACD,CAFD;;AAIA,IAAIC,cAAJ;AACA,IAAIC,kBAAkB,GAAG,KAAzB;AACA,IAAIC,OAAO,GAAG,KAAd;AACA,IAAIC,mBAAJ;AACA,IAAIC,iBAAJ;;AACA,2BAA0CP,mBAAmB,EAA7D;AAAA;AAAA,IAAKQ,eAAL;AAAA,IAAsBC,gBAAtB;AAGA,IAAMC,cAAc,GAAG,uBAAvB;AAYA,IAAMC,kBAA+B,GAAG;AACtCC,EAAAA,MAAM,EAAE,CAD8B;AAEtC3D,EAAAA,KAAK,EAAE;AAF+B,CAAxC;AAKA,IAAM4D,mBAAiC,GAAG;AACxCC,EAAAA,SAAS,EAAE,KAD6B;AAExCC,EAAAA,QAAQ,EAAE;AAF8B,CAA1C;;AAOA,IAAMC,WAAW,GAAG,SAAdA,WAAc,GAAM;AACxB,SAAO,CAAC,CAAClD,MAAM,CAACC,UAAP,CAAkB,0BAAlB,EAA8CH,OAAvD;AACD,CAFD;;AAIA,IAAMqD,aAAa,GAAG,SAAhBA,aAAgB,GAAM;AAC1BN,EAAAA,kBAAkB,CAAC1D,KAAnB,GAA2B+C,mBAAmB,GAAG,CAAH,CAA9C;AACAW,EAAAA,kBAAkB,CAACC,MAAnB,GAA4BZ,mBAAmB,GAAG,CAAH,CAA/C;AACD,CAHD;;AAKA,IAAMkB,kBAAkB,GAAG,SAArBA,kBAAqB,GAAM;AAC/BL,EAAAA,mBAAmB,CAACC,SAApB,GAAgCE,WAAW,EAA3C;AACAH,EAAAA,mBAAmB,CAACE,QAApB,GAA+B,CAACF,mBAAmB,CAACC,SAApD;AACD,CAHD;;AAKA,IAAMK,UAAU,GAAG,SAAbA,UAAa,GAAM;AACvBf,EAAAA,kBAAkB,GAAG,KAArB;AACAC,EAAAA,OAAO,GAAG,KAAV;AACAE,EAAAA,iBAAiB,GAAG,IAApB;AACD,CAJD;;AAMA,IAAIa,yBAAyB,GAAG,KAAhC;;AACA,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,GAAM;AAC/B;AACA,MAAIC,aAAa,EAAjB,EAAqB;AACnB;AACAxD,IAAAA,MAAM,CAACwB,gBAAP,CAAwB,QAAxB,EAAkCiC,mCAAlC,EAAuE,KAAvE;AACAzD,IAAAA,MAAM,CAACwB,gBAAP,CAAwB,mBAAxB,EAA6CiC,mCAA7C,EAAkF,KAAlF;AACD,GAJD,MAIO;AACL;AACAzD,IAAAA,MAAM,CAACwB,gBAAP,CAAwB,QAAxB,EAAkCkC,iBAAlC,EAAqD,KAArD;AACD;;AACDP,EAAAA,aAAa;AACbC,EAAAA,kBAAkB;AAClBE,EAAAA,yBAAyB,GAAG,IAA5B;AACD,CAbD;;;AAgBA,IAAMK,uBAAuB,GAAG,SAA1BA,uBAA0B,GAAM;AACpCP,EAAAA,kBAAkB;AAClBxE,EAAAA,aAAa,CAACmC,SAAd,CAAwB,aAAxB,EAAuC;AACrCiC,IAAAA,SAAS,EAAED,mBAAmB,CAACC,SADM;AAErCC,IAAAA,QAAQ,EAAEF,mBAAmB,CAACE;AAFO,GAAvC;AAID,CAND;;AAQA,IAAMW,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;AAChC;AACA;AACA;AACA;AACA,MAAIrB,OAAO,IAAID,kBAAf,EAAmC;AACjCqB,IAAAA,uBAAuB;AACvBE,IAAAA,kBAAkB;AAClBvB,IAAAA,kBAAkB,GAAG,KAArB;AACAC,IAAAA,OAAO,GAAG,KAAV;;AACA,QAAIE,iBAAJ,EAAuB;AACrBzC,MAAAA,MAAM,CAACY,YAAP,CAAoB6B,iBAApB;AACAA,MAAAA,iBAAiB,GAAG,IAApB;AACD;AACF;;AACDD,EAAAA,mBAAmB,GAAG,IAAtB;AACD,CAhBD;;AAkBA,IAAMiB,mCAAmC,GAAG,SAAtCA,mCAAsC,CAACK,GAAD,EAAS;AACnD,MAAIA,GAAG,CAACC,IAAJ,KAAa,QAAjB,EAA2B;AACzB,QAAInB,cAAc,CAACoB,IAAf,CAAoBC,QAAQ,CAACC,aAAT,CAAuBC,OAA3C,KAAuD,CAAC7B,kBAA5D,EAAgF;AAC9E;AACD;;AAED,gCAA4CJ,mBAAmB,EAA/D;AAAA;AAAA,QAAOkC,eAAP;AAAA,QAAwBC,gBAAxB;;AACA,IAAc,IAAIC,IAAJ,GAAWC,OAAX,GANW;;AAQzB,QAAIF,gBAAgB,KAAK1B,gBAArB,IAAyCyB,eAAe,KAAK1B,eAAjE,EAAkF;AAChF;AACD;;AACDH,IAAAA,OAAO,GAAG,IAAV,CAXyB;AAazB;;AACA,QAAII,gBAAgB,KAAK0B,gBAArB,IAAyC3B,eAAe,KAAK0B,eAAjE,EAAkF;;AAQhFP,MAAAA,kBAAkB;AACnB,KATD,MASO;AACLnB,MAAAA,eAAe,GAAG0B,eAAlB;AACD;AAEDzB,IAAAA,gBAAgB,GAAG0B,gBAAnB;;AAEA,QAAI5B,iBAAJ,EAAuB;AACrBzC,MAAAA,MAAM,CAACY,YAAP,CAAoB6B,iBAApB;AACAA,MAAAA,iBAAiB,GAAG,IAApB;AACD,KAhCwB;AAkCzB;AACA;;;AACAA,IAAAA,iBAAiB,GAAGzC,MAAM,CAACa,UAAP,CAAkBwC,UAAlB,EAA8B,IAA9B,CAApB;AACD,GArCD,MAqCO,IAAIS,GAAG,CAACC,IAAJ,KAAa,mBAAjB,EAAsC;AAC3CzB,IAAAA,kBAAkB,GAAG,IAArB;AACD;;AAED,MAAIE,mBAAJ,EAAyB;AACvB5B,IAAAA,YAAY,CAAC4B,mBAAD,CAAZ;AACAA,IAAAA,mBAAmB,GAAG,IAAtB;AACD;;AACDA,EAAAA,mBAAmB,GAAGxC,MAAM,CAACa,UAAP,CAAkB+C,mBAAlB,EAAuC,EAAvC,CAAtB;AACD,CA/CD;;;AAkDA,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,GAAM;AAC/BV,EAAAA,aAAa;AACbvE,EAAAA,aAAa,CAACmC,SAAd,CAAwB,QAAxB,EAAkC;AAChC+B,IAAAA,MAAM,EAAED,kBAAkB,CAACC,MADK;AAEhC3D,IAAAA,KAAK,EAAE0D,kBAAkB,CAAC1D;AAFM,GAAlC;AAID,CAND;;AAQA,IAAMqF,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAM;AAChCX,EAAAA,kBAAkB;AAClBxB,EAAAA,cAAc,GAAG,IAAjB;AACD,CAHD;;AAKA,IAAMqB,iBAAiB,GAAG,SAApBA,iBAAoB,GAAM;AAC9B,MAAMe,IAAI,GAAG1B,mBAAmB,CAACC,SAAjC;AACA,MAAM0B,GAAG,GAAGxB,WAAW,EAAvB;;AACA,MAAIuB,IAAI,KAAKC,GAAb,EAAkB;AAChBf,IAAAA,uBAAuB;AACxB,GAL6B;AAO9B;AACA;;;AACA,MAAI,CAACtB,cAAL,EAAqB;AACnBA,IAAAA,cAAc,GAAGrC,MAAM,CAACa,UAAP,CAAkB2D,mBAAlB,EAAuC,GAAvC,CAAjB;AACD;AACF,CAZD;;IAoBaG,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACC,UAAD,EAAyD;AAC1F,MAAI,CAACtB,yBAAL,EAAgC;AAC9BC,IAAAA,kBAAkB;AACnB;;AACD3E,EAAAA,aAAa,CAACmD,WAAd,CAA0B,QAA1B,EAAoC6C,UAApC;AACD;IAEYC,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACD,UAAD,EAAmD;AACpFhG,EAAAA,aAAa,CAACqD,WAAd,CAA0B,QAA1B,EAAoC2C,UAApC;AACD;;IAGYE,cAAc,GAAG,SAAjBA,cAAiB,GAAoB;AAChD,SAAO/B,mBAAP;AACD;IAEYgC,8BAA8B,GAAG,SAAjCA,8BAAiC,CAACH,UAAD,EAA2D;AACvG,MAAI,CAACtB,yBAAL,EAAgC;AAC9BC,IAAAA,kBAAkB;AACnB;;AACD3E,EAAAA,aAAa,CAACmD,WAAd,CAA0B,aAA1B,EAAyC6C,UAAzC;AACD;IAEYI,8BAA8B,GAAG,SAAjCA,8BAAiC,CAACJ,UAAD,EAAqD;AACjGhG,EAAAA,aAAa,CAACqD,WAAd,CAA0B,aAA1B,EAAyC2C,UAAzC;AACD;;;;"}