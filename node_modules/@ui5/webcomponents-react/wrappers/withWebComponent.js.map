{"version":3,"file":"withWebComponent.js","sources":["../src/internal/withWebComponent.tsx"],"sourcesContent":["import { getEffectiveScopingSuffixForTag } from '@ui5/webcomponents-base/dist/CustomElementsScope.js';\nimport { deprecationNotice } from '@ui5/webcomponents-react-base/dist/Utils';\nimport { useSyncRef } from '@ui5/webcomponents-react-base/dist/hooks';\nimport React, { Children, cloneElement, ComponentType, forwardRef, ReactElement, Ref, useEffect, useRef } from 'react';\nimport { CommonProps } from '@ui5/webcomponents-react/interfaces/CommonProps';\nimport { Ui5DomRef } from '@ui5/webcomponents-react/interfaces/Ui5DomRef';\n\nconst capitalizeFirstLetter = (s: string) => s.charAt(0).toUpperCase() + s.slice(1);\n\nconst camelToKebabCase = (s: string) => s.replace(/([A-Z])/g, (a, b: string) => `-${b.toLowerCase()}`);\nconst kebabToCamelCase = (str: string) => str.replace(/([-_]\\w)/g, (g) => g[1].toUpperCase());\n\nconst createEventPropName = (eventName) => `on${capitalizeFirstLetter(kebabToCamelCase(eventName))}`;\n\ntype EventHandler = (event: CustomEvent<unknown>) => void;\n\nexport const withWebComponent = <Props extends Record<string, any>, RefType = Ui5DomRef>(\n  tagName: string,\n  regularProperties: string[],\n  booleanProperties: string[],\n  slotProperties: string[],\n  eventProperties: string[]\n) => {\n  const WithWebComponent = forwardRef((props: Props, wcRef: Ref<RefType>) => {\n    const { className, tooltip, children, ...rest } = props;\n    //@ts-ignore\n    const [componentRef, ref] = useSyncRef<HTMLElement>(wcRef);\n    const eventRegistry = useRef<Record<string, EventHandler>>({});\n\n    // regular props (no booleans, no slots and no events)\n    const regularProps = regularProperties.reduce((acc, name) => {\n      if (rest.hasOwnProperty(name)) {\n        return { ...acc, [camelToKebabCase(name)]: rest[name] };\n      }\n      return acc;\n    }, {});\n\n    // boolean properties - only attach if they are truthy\n    const booleanProps = booleanProperties.reduce((acc, name) => {\n      if (rest[name] === true || rest[name] === 'true') {\n        return { ...acc, [camelToKebabCase(name)]: true };\n      }\n      return acc;\n    }, {});\n\n    const slots = slotProperties.reduce((acc, name) => {\n      const slotValue = rest[name] as ReactElement;\n\n      if (!slotValue) return acc;\n\n      const slottedChildren = [];\n      let index = 0;\n      const removeFragments = (element) => {\n        if (!element) return;\n        if (element.type === React.Fragment) {\n          Children.toArray(element.props?.children)\n            .filter(Boolean)\n            .forEach((item) => {\n              removeFragments(item);\n            });\n        } else {\n          slottedChildren.push(\n            cloneElement(element, {\n              key: `${name}-${index}`,\n              slot: name\n            })\n          );\n          index++;\n        }\n      };\n\n      if (Array.isArray(slotValue)) {\n        slotValue.forEach((item) => {\n          removeFragments(item);\n        });\n      } else {\n        removeFragments(slotValue);\n      }\n      return [...acc, ...slottedChildren];\n    }, []);\n    // event binding\n    useEffect(\n      () => {\n        eventProperties.forEach((eventName) => {\n          const eventHandler = rest[createEventPropName(eventName)] as EventHandler;\n          if (typeof eventHandler === 'function') {\n            eventRegistry.current[eventName] = eventHandler;\n            ref.current.addEventListener(eventName, eventRegistry.current[eventName]);\n          }\n        });\n\n        return () => {\n          // eslint-disable-next-line guard-for-in\n          for (const eventName in eventRegistry.current) {\n            ref.current?.removeEventListener(eventName, eventRegistry.current[eventName]);\n          }\n        };\n      },\n      eventProperties.map((eventName) => rest[createEventPropName(eventName)])\n    );\n\n    // non web component related props, just pass them\n    const nonWebComponentRelatedProps = Object.entries(rest)\n      .filter(([key]) => !regularProperties.includes(key))\n      .filter(([key]) => !slotProperties.includes(key))\n      .filter(([key]) => !booleanProperties.includes(key))\n      .filter(([key]) => !eventProperties.map((eventName) => createEventPropName(eventName)).includes(key))\n      .reduce((acc, [key, val]) => ({ ...acc, [key]: val }), {});\n\n    const tagNameSuffix: string = getEffectiveScopingSuffixForTag(tagName);\n    const Component = (tagNameSuffix ? `${tagName}-${tagNameSuffix}` : tagName) as unknown as ComponentType<\n      CommonProps & { class: string }\n    >;\n\n    useEffect(() => {\n      if (tooltip) {\n        // strip ui5 prefix and convert to PascalCase\n        const componentName = tagName.substring(3).replace(/(^\\w|-\\w)/g, (text) => text.replace(/-/, '').toUpperCase());\n        deprecationNotice(\n          componentName,\n          '`tooltip` has been deprecated, please use the native `title` attribute instead.'\n        );\n      }\n    }, [tooltip]);\n\n    return (\n      <Component\n        ref={componentRef}\n        title={tooltip}\n        {...booleanProps}\n        {...regularProps}\n        {...nonWebComponentRelatedProps}\n        class={className}\n      >\n        {slots}\n        {children}\n      </Component>\n    );\n  });\n\n  return WithWebComponent;\n};\n"],"names":["capitalizeFirstLetter","s","charAt","toUpperCase","slice","camelToKebabCase","replace","a","b","toLowerCase","kebabToCamelCase","str","g","createEventPropName","eventName","withWebComponent","tagName","regularProperties","booleanProperties","slotProperties","eventProperties","WithWebComponent","forwardRef","props","wcRef","className","tooltip","children","rest","useSyncRef","componentRef","ref","eventRegistry","useRef","regularProps","reduce","acc","name","hasOwnProperty","booleanProps","slots","slotValue","slottedChildren","index","removeFragments","element","type","React","Fragment","Children","toArray","filter","Boolean","forEach","item","push","cloneElement","key","slot","Array","isArray","useEffect","eventHandler","current","addEventListener","removeEventListener","map","nonWebComponentRelatedProps","Object","entries","includes","val","tagNameSuffix","getEffectiveScopingSuffixForTag","Component","componentName","substring","text","deprecationNotice"],"mappings":"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"}